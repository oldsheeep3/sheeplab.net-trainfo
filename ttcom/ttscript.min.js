function preventScroll(e){e.preventDefault()}function overlay(e=null){const t=document.querySelector(".ovr");null===e?t&&t.innerHTML&&(t.innerHTML="",console.log("loaded"),window.removeEventListener("scroll",preventScroll)):(window.addEventListener("scroll",preventScroll,{passive:!1}),"loading"!==e||(t.innerHTML='<div class="overlay"><div class="overlay-inner"><div class="loader"></div></div></div>'))}function setOverlay(){const e=setInterval(()=>{let t=()=>{if(loadedJsonDatas.length!==loadingJsonDatas.length)return!1;var e=loadedJsonDatas.slice().sort(),t=loadingJsonDatas.slice().sort();for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0};t()?(clearInterval(e),overlay(),loadedJsonDatas=[],loadingJsonDatas=[]):overlay("loading")},1e3)}function checkOverflow(e,t){return t.scrollWidth>e.clientWidth}function applyAnimationIfOverflow(e){let t=e.querySelector(".route-inner");if(checkOverflow(e,t)){let n=e.scrollWidth;document.documentElement.style.setProperty("--item-width",`${n}px`),t.classList.add("scranm")}else t.classList.remove("scranm")}function checkAllRoutes(){routeElements=document.querySelectorAll(".route"),routeElements.forEach(e=>applyAnimationIfOverflow(e))}function getQ(){const e=decodeURI(window.location.search.slice(1)),t={};return e&&e.split("&").forEach(function(e){const n=e.split("=");t[n[0]]=n[1]}),t}function twoDigit(e){return e<10?"0"+e:e}function timeDifference(e,t){const n=3,o=e=>{const[t,n]=e.split(":").map(Number);return 60*t+n};let s=o(e),a=o(t);s<60*n&&(s+=1440),a<60*n&&(a+=1440);let l=a-s;return l}function sName(){const e=getQ();return station=e.station||"鶴舞",e.s2&&e.dt?(s2=e.s2,dt=parseInt(e.dt,10),document.querySelector("#s-name").innerHTML=`${station} - ${s2} 乗換案内`,!0):(document.querySelector("#s-name").innerHTML=`${station} 駅 列車状況`,!1)}function loadJson(e,t){return loadingJsonDatas.includes(t)?new Promise(t=>{t({data:e,updated:!1})}):new Promise((n,o)=>{let s;if(e)n({data:e,updated:!1});else{loadingJsonDatas.push(t);const e=new XMLHttpRequest;e.open("GET",`/tt/${t}.json`),e.onload=(()=>{200===e.status?(s=JSON.parse(e.response),n({data:s,updated:!0})):o(`Error: ${e.status}`)}),e.onerror=(()=>{o("Request failed")}),e.send()}})}function times(e,t,n,o=cacheds1,s=0){let a=e.route,l=e.color,i=e.id,r=i.slice(0,2),c=[],d=null,u=!1,p=null,m=null,f=null,y=null,h=null;if(onStationTime&&0!=s&&([dhours,dminutes]=onStationTime.split(":").map(Number),hhmm=60*dhours+dminutes,0!=s&&(hhmm+=s),dminute=twoDigit(hhmm%60),dhour=twoDigit((hhmm/60|0)%24),t=`${dhour}:${dminute}`),timeDifference("00:00",t)<180&&timeDifference("00:00",t)>=0&&(n=(n-1)%7),0==n||6==n?(weekdaySet=o.w[a],document.querySelector("#day").innerHTML='<span class="yellow">休日ダイヤ</span>'):(weekdaySet=o.d[a],document.querySelector("#day").innerHTML="平日ダイヤ"),o&&weekdaySet&&weekdaySet.forEach(e=>{timeDifference(t,e.time)>0&&(t<e.time||e.time<"04:00")&&(typeCode=typeColor[r]&&typeColor[r][e.type]&&typeColor[r][e.type].code||null,addCode=typeCode?`${r}-${typeCode}`:null,e.last.endsWith("回り")?linetype="loopline":linetype="destination",c.push({time:e.time,type:e.type,last:e.last,code:addCode,litp:linetype}))}),c.length>0){const e=c.sort((e,n)=>timeDifference(t,e.time)-timeDifference(t,n.time));let n,o;u?(p='class="delay"',m='class="delay"'):(p="",m=""),f=e[0],y=e[1],h=(e=>(tdf=timeDifference(t,e),0==s?tdf<=7?`<span class="red">あと 約 <span class="tdf">${tdf}</span> 分 あきらめよう。</span>`:tdf<=13?`<span class="yellow">あと 約 <span class="tdf">${tdf}</span> 分 走れば間に合う？</span>`:`あと 約 <span class="tdf">${tdf}</span> 分`:`乗換時間 約 <span class="tdf">${tdf}</span> 分`));let i="",r="",d="",v="";f&&f.code&&(i=`<span class="${f.code} tCC">`,r="</span>"),y&&y.code&&(d=`<span class="${y.code} tCC">`,v="</span>"),n=f?`<div class="route"><h2 class="route-inner" style="color:${l};">${a}</h2></div><div class="first"><p class="next">${f.time}</p><p class="last">${i}${f.type}${r} <span class="${y.litp}">${f.last}</span></p><p class="limit">${h(f.time)}</p></div>`:`<div class="route"><h2 class="route-inner">${a}</h2></div><p class="fin">☆日本は終了しました☆</p>`,o=y?`<div class="second"><p ${m}><span class="next2">${y.time}</span><span class="last2"> ${d}${y.type}${v} <span class="${y.litp}">${y.last}</span></span></p><p class="limit2">${h(y.time)}</p></div>`:'<p class="fin yellow">☆これが終電です☆</p>',itemContent=n+o}else itemContent=`<div class="route"><h2 class="route-inner">${a}</h2></div><p class="fin">☆日本は終了しました☆</p>`;0==s?(onStationTime=f.time,d="time-data"):d="time-data-2";const v=document.getElementById(d);let $=document.getElementById(a);$?itemContent.replace(/\s+/g,"").replace('"',"'").trim()!=$.innerHTML.replace("scranm","").replace(/\s+/g,"").replace('"',"'").trim()&&($.innerHTML=itemContent,applyAnimationIfOverflow($.querySelector(".route"))):($=document.createElement("li"),$.id=a,$.className=`${d}-li`,$.innerHTML=itemContent,v.appendChild($),applyAnimationIfOverflow($.querySelector(".route")))}function addTypeCss(){let e=".tCC{border-radius: 0.7rem;padding: 0 0.5rem;}";Object.keys(typeColor).forEach(t=>{Object.keys(typeColor[t]).forEach(n=>{const o=typeColor[t][n];e+=`.${t}-${o.code}{color:${o.color};background-color:${o.bgcolor};}`})});const t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}function norikaeFunc(e,t){return!(!t||!t.station)&&(routes=[],Object.keys(t.station.no).forEach(n=>{tN=t.station.no[n],oN=e.station.no[n]||null,oN&&(transRoute=n,oN-tN>0?(oS1="-u",oS2="-d"):(oS1="-d",oS2="-u"))}),!!transRoute&&{onRoute:transRoute+oS1,delRoute:[`${transRoute}-u`,`${transRoute}-d`]})}function noTranslate(){console.log("no translate")}function clock(){let e=new Date,t=e.getFullYear(),n=e.getMonth()+1,o=e.getDate(),s=e.getDay(),a=twoDigit(e.getHours()),l=twoDigit(e.getMinutes()),i=twoDigit(e.getSeconds()),r=t+"年"+n+"月"+o+"日 ("+days[s]+")",c="現在時刻:"+a+":"+l+":"+i;document.querySelector("#realTime").innerHTML=c,document.querySelector("#realDate").innerHTML=r,loadJson(cacheds1,station).then(e=>{e.updated&&(loadedJsonDatas.push(station),cacheds1=e.data),updateTimes(s)}),trans&&loadJson(cacheds2,s2).then(e=>{e.updated&&(loadedJsonDatas.push(s2),cacheds2=e.data),updateTimes(s)})}function updateTimes(e){let t=twoDigit((new Date).getHours())+":"+twoDigit((new Date).getMinutes());trans?(transInfo=norikaeFunc(cacheds1,cacheds2),transInfo&&(times(cacheds1.data.find(e=>e.id===transInfo.onRoute),t,e),cacheds2.data.forEach(function(n){!1===transInfo.delRoute.includes(n.id)&&(onStationTime&&(t=onStationTime),times(n,t,e,cacheds2,dt))}))):cacheds1.data.forEach(function(n){times(n,t,e)})}let station="鶴舞",s2=null,cacheds1=null,cacheds2=null,dt=0,trans=!1,loadingJsonDatas=[],loadedJsonDatas=[],onStationTime=null;const norikaeTime=1;let routeElements=document.querySelectorAll(".route");const days=["日","月","火","水","木","金","土"];loadJson(null,"typecolor").then(e=>{loadedJsonDatas.push("typecolor"),typeColor=e.data,addTypeCss()}),window.onload=function(){cacheds1=null,cacheds2=null,trans=sName(),checkAllRoutes()},window.addEventListener("resize",checkAllRoutes),window.onresize=checkAllRoutes,overlay("loading"),setInterval("clock()",1e3),setTimeout(setOverlay(),500);